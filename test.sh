#!/bin/bash

#test it compiles
gcc shellcodeGenerator.c -o shellcodeGenerator.out
if [ $? -ne "0" ]; then
	echo "Failed shellcodeGenerator.c complication..."
	exit 1
fi

#test can generate shell code
./shellcodeGenerator.out /bin/bash -c "touch test.txt"
if [ $? -ne "0" ]; then
	echo "Failed to generate the shellcode..."
	exit 1
fi

#remove file incase exists
if [ -f test.txt ]; then
    rm test.txt
fi

#test shellcode can be built
./build.sh &> /dev/null
if [ $? -ne "0" ]; then
	echo "Failed to build the shellcode..."
	exit 1
fi

#test shellcode operates correctly
#remove file incase exists
if [ ! -f test.txt ]; then
    echo "Shellcode didnt operate correctly..."
    exit 1
fi

#tidy up
rm shellcodeGenerator.out
rm test.txt
rm output.*