#!/bin/bash

#test it compiles
gcc shellcode_generator.c -o shellcode_generator.out
if [ $? -ne "0" ]; then
	echo "Failed shellcode_generator.c complication..."
	exit 1
fi

#test can generate shell code
./shellcode_generator.out /bin/bash -c "touch test.txt"
if [ $? -ne "0" ]; then
	echo "Failed to generate the shellcode..."
	exit 1
fi

#remove file incase exists
if [ -f test.txt ]; then
    rm test.txt
fi

#test shellcode can be built
./build.sh &> /dev/null
if [ $? -ne "0" ]; then
	echo "Failed to build the shellcode..."
	exit 1
fi

#test shellcode operates correctly
#remove file incase exists
if [ ! -f test.txt ]; then
    echo "Shellcode didnt operate correctly..."
    exit 1
fi

#tidy up
rm shellcode_generator.out
rm test.txt
rm output.*